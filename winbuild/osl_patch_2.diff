From 1c25777472da56b32760bc40b5993655fc06816e Mon Sep 17 00:00:00 2001
From: Alex Fuller <boberfly@gmail.com>
Date: Sun, 17 Sep 2017 14:15:23 -0700
Subject: [PATCH] Flex/Bison windows fix

---
diff --git a/OpenShadingLanguage-Release-1.8.12/src/cmake/flexbison.cmake b/OpenShadingLanguage-Release-1.8.12/src/cmake/flexbison.cmake
index becaf30..bd9d7c4 100755
--- a/OpenShadingLanguage-Release-1.8.12/src/cmake/flexbison.cmake
+++ b/OpenShadingLanguage-Release-1.8.12/src/cmake/flexbison.cmake
@@ -62,8 +62,12 @@ IF ( FLEX_EXECUTABLE AND BISON_EXECUTABLE )
         # Be really sure that we prefer the FlexLexer.h that comes with
         # the flex binary we're using, not some other one in the system.
         GET_FILENAME_COMPONENT ( FLEX_UP ${FLEX_EXECUTABLE} PATH )
-        GET_FILENAME_COMPONENT ( FLEX_UP_UP ${FLEX_UP} PATH )
-        SET ( FLEX_INCLUDE_DIR "${FLEX_UP_UP}/include" )
+        if ( MSVC )^M
+            SET ( FLEX_INCLUDE_DIR "${FLEX_UP_UP}/../include" )^M
+        else ()^M
+            GET_FILENAME_COMPONENT ( FLEX_UP_UP ${FLEX_UP} PATH )^M
+            SET ( FLEX_INCLUDE_DIR "${FLEX_UP_UP}/include" )^M
+        endif ()^M
         if (VERBOSE)
             MESSAGE (STATUS "Flex include dir = ${FLEX_INCLUDE_DIR}")
         endif ()
@@ -76,8 +80,13 @@ IF ( FLEX_EXECUTABLE AND BISON_EXECUTABLE )
           MAIN_DEPENDENCY ${bisonsrc}
           DEPENDS ${${compiler_headers}}
           WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} )
+        if ( WINDOWS )^M
+            SET ( WINCOMPAT --wincompat )^M
+        else ()^M
+            SET ( WINCOMPAT )^M
+        endif ()^M
         ADD_CUSTOM_COMMAND ( OUTPUT ${flexoutputcxx}
-          COMMAND ${FLEX_EXECUTABLE} -o ${flexoutputcxx} "${CMAKE_CURRENT_SOURCE_DIR}/${flexsrc}"
+          COMMAND ${FLEX_EXECUTABLE} ${WINCOMPAT} -o ${flexoutputcxx} "${CMAKE_CURRENT_SOURCE_DIR}/${flexsrc}"^M
           MAIN_DEPENDENCY ${flexsrc}
           DEPENDS ${${compiler_headers}}
           WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} )